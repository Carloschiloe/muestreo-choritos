<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Resumen de Resultados</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }

        .container {
            max-width: 100%;
            margin: auto;
            padding: 0;
        }

        .summary-table {
            width: 100%;
            table-layout: fixed;
            word-wrap: break-word;
            margin-top: 20px;
        }

        .summary-table th,
        .summary-table td {
            text-align: center;
            vertical-align: middle;
            padding: 10px;
            font-size: 14px;
            word-wrap: break-word; /* Ajustar palabras largas */
        }

        .summary-table th {
            position: sticky;
            top: 0;
            background-color: #f8f9fa;
            z-index: 2;
        }

        .thumbnail {
            width: 40px;
            height: 40px;
            object-fit: cover;
        }

        .edit-btn,
        .delete-btn {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }

        /* Estilos responsivos */
        @media (max-width: 768px) {
            .summary-table th,
            .summary-table td {
                font-size: 12px;
                padding: 5px;
            }

            .thumbnail {
                width: 30px;
                height: 30px;
            }
        }

        @media (max-width: 576px) {
            .summary-table th,
            .summary-table td {
                font-size: 10px;
                padding: 4px;
            }

            .thumbnail {
                width: 25px;
                height: 25px;
            }
        }

        .filter-dropdown {
            padding: 5px;
            font-size: 12px;
            width: 100%;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="text-center">Resumen de Resultados</h1>
        <table class="table table-bordered summary-table">
            <thead>
                <tr>
                    <th>Fecha
                        <select class="filter-dropdown" onchange="filterColumn(0)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Hora
                        <select class="filter-dropdown" onchange="filterColumn(1)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Temp (°C)
                        <select class="filter-dropdown" onchange="filterColumn(2)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Centro Cultivo
                        <select class="filter-dropdown" onchange="filterColumn(3)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>N° Línea
                        <select class="filter-dropdown" onchange="filterColumn(4)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Plataforma
                        <select class="filter-dropdown" onchange="filterColumn(5)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Rotos (%)
                        <select class="filter-dropdown" onchange="filterColumn(6)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Trizados (%)
                        <select class="filter-dropdown" onchange="filterColumn(7)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Cholgas (%)
                        <select class="filter-dropdown" onchange="filterColumn(8)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Malton (%)
                        <select class="filter-dropdown" onchange="filterColumn(9)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Picorocos (%)
                        <select class="filter-dropdown" onchange="filterColumn(10)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Otros (%)
                        <select class="filter-dropdown" onchange="filterColumn(11)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Choritos (%)
                        <select class="filter-dropdown" onchange="filterColumn(12)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Observaciones
                        <select class="filter-dropdown" onchange="filterColumn(13)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Responsable
                        <select class="filter-dropdown" onchange="filterColumn(14)">
                            <option value="">Todos</option>
                        </select>
                    </th>
                    <th>Foto</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="summaryTableBody">
                <!-- Filas agregadas dinámicamente -->
            </tbody>
        </table>
    </div>

    <script>
        let storedSamples = JSON.parse(localStorage.getItem('storedSamples')) || [];
        const tbody = document.getElementById('summaryTableBody');
        const filterDropdowns = document.querySelectorAll('.filter-dropdown');

        // Generar las opciones para los filtros
        function populateFilters() {
            const columnsData = Array.from({ length: 15 }, () => new Set());

            storedSamples.forEach(sample => {
                columnsData[0].add(sample.fecha);
                columnsData[1].add(sample.hora);
                columnsData[2].add(sample.temperatura);
                columnsData[3].add(sample.centro);
                columnsData[4].add(sample.linea);
                columnsData[5].add(sample.plataforma);
                columnsData[6].add(((parseFloat(sample.rotos) / parseFloat(sample.total)) * 100).toFixed(2));
                columnsData[7].add(((parseFloat(sample.trizados) / parseFloat(sample.total)) * 100).toFixed(2));
                columnsData[8].add(((parseFloat(sample.cholgas) / parseFloat(sample.total)) * 100).toFixed(2));
                columnsData[9].add(((parseFloat(sample.malton) / parseFloat(sample.total)) * 100).toFixed(2));
                columnsData[10].add(((parseFloat(sample.picorocos) / parseFloat(sample.total)) * 100).toFixed(2));
                columnsData[11].add(((parseFloat(sample.otros) / parseFloat(sample.total)) * 100).toFixed(2));
                columnsData[12].add(((parseFloat(sample.total) - (parseFloat(sample.rotos) + parseFloat(sample.trizados) + parseFloat(sample.cholgas) + parseFloat(sample.malton) + parseFloat(sample.picorocos) + parseFloat(sample.otros))) / parseFloat(sample.total) * 100).toFixed(2));
                columnsData[13].add(sample.observaciones);
                columnsData[14].add(sample.responsable);
            });

            filterDropdowns.forEach((dropdown, index) => {
                const options = Array.from(columnsData[index]).sort();
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    dropdown.appendChild(optionElement);
                });
            });
        }

        // Filtrar por columna seleccionada
        function filterColumn(columnIndex) {
            const selectedValue = filterDropdowns[columnIndex].value;
            const filteredSamples = selectedValue === "" ? storedSamples : storedSamples.filter(sample => {
                switch (columnIndex) {
                    case 0: return sample.fecha === selectedValue;
                    case 1: return sample.hora === selectedValue;
                    case 2: return sample.temperatura === selectedValue;
                    case 3: return sample.centro === selectedValue;
                    case 4: return sample.linea === selectedValue;
                    case 5: return sample.plataforma === selectedValue;
                    case 6: return ((parseFloat(sample.rotos) / parseFloat(sample.total)) * 100).toFixed(2) === selectedValue;
                    case 7: return ((parseFloat(sample.trizados) / parseFloat(sample.total)) * 100).toFixed(2) === selectedValue;
                    case 8: return ((parseFloat(sample.cholgas) / parseFloat(sample.total)) * 100).toFixed(2) === selectedValue;
                    case 9: return ((parseFloat(sample.malton) / parseFloat(sample.total)) * 100).toFixed(2) === selectedValue;
                    case 10: return ((parseFloat(sample.picorocos) / parseFloat(sample.total)) * 100).toFixed(2) === selectedValue;
                    case 11: return ((parseFloat(sample.otros) / parseFloat(sample.total)) * 100).toFixed(2) === selectedValue;
                    case 12: return ((parseFloat(sample.total) - (parseFloat(sample.rotos) + parseFloat(sample.trizados) + parseFloat(sample.cholgas) + parseFloat(sample.malton) + parseFloat(sample.picorocos) + parseFloat(sample.otros))) / parseFloat(sample.total) * 100).toFixed(2) === selectedValue;
                    case 13: return sample.observaciones === selectedValue;
                    case 14: return sample.responsable === selectedValue;
                }
            });
            displaySamples(filteredSamples);
        }

        function displaySamples(samples = storedSamples) {
            tbody.innerHTML = '';
            samples.slice().reverse().forEach((sample, index) => {
                const row = document.createElement('tr');
                const total = parseFloat(sample.total) || 0;
                const rotos = parseFloat(sample.rotos) || 0;
                const trizados = parseFloat(sample.trizados) || 0;
                const cholgas = parseFloat(sample.cholgas) || 0;
                const malton = parseFloat(sample.malton) || 0;
                const picorocos = parseFloat(sample.picorocos) || 0;
                const otros = parseFloat(sample.otros) || 0;
                const choritos = total - (rotos + trizados + cholgas + malton + picorocos + otros);

                const fotoUrl = typeof sample.foto === 'string' ? sample.foto : "";
                const fotoHtml = fotoUrl ? `<a href="${fotoUrl}" target="_blank"><img src="${fotoUrl}" class="thumbnail" alt="Foto"></a>` : "No disponible";

                row.innerHTML = `
                    <td>${sample.fecha}</td>
                    <td>${sample.hora}</td>
                    <td>${sample.temperatura}</td>
                    <td>${sample.centro}</td>
                    <td>${sample.linea}</td>
                    <td>${sample.plataforma}</td>
                    <td>${(rotos / total * 100).toFixed(2)}</td>
                    <td>${(trizados / total * 100).toFixed(2)}</td>
                    <td>${(cholgas / total * 100).toFixed(2)}</td>
                    <td>${(malton / total * 100).toFixed(2)}</td>
                    <td>${(picorocos / total * 100).toFixed(2)}</td>
                    <td>${(otros / total * 100).toFixed(2)}</td>
                    <td>${(choritos / total * 100).toFixed(2)}</td>
                    <td>${sample.observaciones || ""}</td>
                    <td>${sample.responsable}</td>
                    <td>${fotoHtml}</td>
                    <td>
                        <span class="edit-btn" onclick="loadSampleToForm(${storedSamples.length - 1 - index})">✏️</span> |
                        <span class="delete-btn" onclick="deleteRow(${storedSamples.length - 1 - index})">❌</span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadSampleToForm(index) {
            const sample = storedSamples[index];
            localStorage.setItem('editIndex', index);
            localStorage.setItem('editingSample', JSON.stringify(sample));
            window.location.href = 'formulario.html';
        }

        function deleteRow(index) {
            if (confirm('¿Estás seguro de que deseas eliminar este registro?')) {
                storedSamples.splice(index, 1);
                localStorage.setItem('storedSamples', JSON.stringify(storedSamples));
                displaySamples();
            }
        }

        populateFilters();
        displaySamples();
    </script>
</body>

</html>










